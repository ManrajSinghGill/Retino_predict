<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Information and Calorie Logging</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400&display=swap"
        rel="stylesheet">

    <!-- Bootstrap CDN -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../static/style.css">
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- Header -->
    <header class="bg-purple text-white py-3">
        <!-- Include Navbar -->
        <div id="navbar"></div>
        <script>
            fetch("navbar.html")
                .then(response => response.text())
                .then(data => document.getElementById("navbar").innerHTML = data);
        </script>
    </header>

    <!-- Food Information Section -->
    <section id="food-info" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center text-purple mb-4">Food Information and Calories</h2>
            <p class="text-center text-muted mb-5">Explore nutritional information and calorie counts for various food
                items to make informed dietary choices.</p>

            <!-- Search Bar -->
            <div class="mb-4">
                <input type="text" id="searchBar" class="form-control" placeholder="Search for a food item...">
            </div>

            <!-- Food Table -->
            <div class="table-responsive">
                <table id="foodTable" class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th>Food Item</th>
                            <th>Calories (per 100g)</th>
                            <th>Nutritional Information</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Apple</td>
                            <td>52 kcal</td>
                            <td>High in fiber, vitamin C</td>
                        </tr>
                        <tr>
                            <td>Brown Rice</td>
                            <td>112 kcal</td>
                            <td>High in complex carbs</td>
                        </tr>
                        <tr>
                            <td>Salmon</td>
                            <td>208 kcal</td>
                            <td>Rich in omega-3 fats</td>
                        </tr>
                        <tr>
                            <td>Broccoli</td>
                            <td>34 kcal</td>
                            <td>Rich in vitamins K and C</td>
                        </tr>
                        <tr>
                            <td>Chicken Breast</td>
                            <td>165 kcal</td>
                            <td>High in protein</td>
                        </tr>
                        <tr>
                            <td>Sweet Potato</td>
                            <td>86 kcal</td>
                            <td>High in beta-carotene</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Calorie Calculator -->
            <div class="mt-5">
                <h4 class="text-purple">Calorie Calculator</h4>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="foodInput">Food Item</label>
                        <input type="text" id="foodInput" class="form-control" placeholder="Enter food item">
                    </div>
                    <div class="form-group col-md-3">
                        <label for="weightInput">Weight (in grams)</label>
                        <input type="number" id="weightInput" class="form-control" placeholder="Enter weight">
                    </div>
                    <div class="form-group col-md-3 d-flex align-items-end">
                        <button id="calculateBtn" class="btn btn-cyan btn-block">Calculate Calories</button>
                    </div>
                </div>
                <p id="calorieOutput" class="mt-3 text-muted"></p>
            </div>
        </div>
    </section>

    <!-- Calorie Logging Section -->
    <main class="container py-5 flex-grow-1">
        <h2 class="text-purple text-center mb-4">Log Your Calorie Intake</h2>

        <!-- Form for logging calories -->
        <form id="calorieForm" class="mb-5">
            <div class="form-group">
                <label for="calories">Calories (kcal):</label>
                <input type="number" id="calories" name="calories" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="date">Date:</label>
                <input type="date" id="date" name="date" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-cyan">Submit</button>
        </form>

        <!-- Recent Entries Table -->
        <h3 class="text-purple">Recent Entries</h3>
        <table class="table table-bordered mt-3">
            <thead>
                <tr class="bg-purple text-white">
                    <th>Date</th>
                    <th>Calories (kcal)</th>
                </tr>
            </thead>
            <tbody id="calorieTable">
                <!-- Dynamic Entries Will Be Added Here -->
            </tbody>
        </table>

        <!-- Visualize Button -->
        <button id="visualizeBtn" class="btn btn-primary mt-4" onclick="visualizeData()">Visualize Chart</button>

        <!-- Canvas for Chart (Initially hidden) -->
        <canvas id="glucoseChart" width="400" height="200" style="display: none;"></canvas>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-auto">
        <p>&copy; 2024 RetinoPredict. All rights reserved.</p>
    </footer>

    <!-- Scripts -->
    <script>
        // Search Functionality for food items
        document.getElementById('searchBar').addEventListener('keyup', function () {
            const searchValue = this.value.toLowerCase();
            const rows = document.querySelectorAll('#foodTable tbody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchValue) ? '' : 'none';
            });
        });

        // Calorie Calculator Functionality
        document.getElementById('calculateBtn').addEventListener('click', function () {
            const foodInput = document.getElementById('foodInput').value.toLowerCase();
            const weightInput = document.getElementById('weightInput').value;

            const calorieData = {
                apple: 52,
                'brown rice': 112,
                salmon: 208,
                broccoli: 34,
                'chicken breast': 165,
                'sweet potato': 86
            };

            if (calorieData[foodInput] && weightInput) {
                const calories = (calorieData[foodInput] * weightInput) / 100;
                document.getElementById('calorieOutput').textContent = `Estimated Calories: ${calories.toFixed(2)} kcal`;
            } else {
                document.getElementById('calorieOutput').textContent = 'Please enter a valid food item and weight.';
            }
        });

        // Load previous calorie entries from localStorage
        function loadEntries() {
            const entries = JSON.parse(localStorage.getItem('calorieEntries')) || [];
            const tableBody = document.getElementById('calorieTable');
            tableBody.innerHTML = ''; // Clear table before adding new entries

            entries.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.calories}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Handle form submission for logging calories
        document.getElementById('calorieForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const calories = document.getElementById('calories').value;
            const date = document.getElementById('date').value;

            if (calories && date) {
                const newEntry = { calories, date };

                // Get existing entries from localStorage or create a new array
                const entries = JSON.parse(localStorage.getItem('calorieEntries')) || [];
                entries.push(newEntry);

                // Save updated entries to localStorage
                localStorage.setItem('calorieEntries', JSON.stringify(entries));

                // Reload the entries to update the table
                loadEntries();

                // Clear the form
                document.getElementById('calorieForm').reset();
            }
        });

        // Visualize button functionality to create a chart
        function visualizeData() {
            const entries = JSON.parse(localStorage.getItem('calorieEntries')) || [];
            const labels = entries.map(entry => entry.date);
            const data = entries.map(entry => entry.calories);

            // Create a chart using Chart.js
            const ctx = document.getElementById('glucoseChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Calories Intake (kcal)',
                        data: data,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: { display: true, text: 'Date' }
                        },
                        y: {
                            title: { display: true, text: 'Calories (kcal)' },
                            beginAtZero: true
                        }
                    }
                }
            });

            // Show the chart
            document.getElementById('glucoseChart').style.display = 'block';
        }

        // Initial load of entries when the page loads
        loadEntries();
    </script>
</body>

</html>